# 1-3. 네트워크 미시적으로 살펴보기

## 프로토콜

- **통신을 주고받는 노드 간에 정보를 올바르게 주고받기 위해 합의된 규칙이나 방법**을 의미한다.
- 서로 다른 통신 장치들이 정보를 주고 받으려면 프로토콜이 통해야한다. 인터넷 사용, 이메일 주고받기, 파일 주고받기 등이 가능한것은 모두 상대 호스트와 동일한 프로토콜을 사용하기 때문이다.
- 통신 과정에서는 하나의 프로토콜만 사용하지 않는다. 일반적으로 여러 프로토콜을 함께 사용한다.
- IP, TCP, UDP, HTTP 등 프로토콜의 종류는 매우 다양하다.
- 모든 프로토콜에는 저마다의 **목적**과 **특징**이 있다.
- 프로토콜마다 패킷의 헤더 내용이 달라질 수 있다.

## 네트워크 참조 모델

- 네트워크의 전송 단계를 계층으로 표현한 것을 말한다.
- 네트워크를 통해 정보를 주고받을 때는 정형화된 여러 단계를 거치는데, 이 과정은 계층으로 표현할 수 있다.
- 통신이 일어나는 각 과정을 계층으로 나눈 구조를 **네트워크 참조 모델** (or **네트워크 계층 모델)** 이라고 한다.
- 통신과정을 계층으로 나눈 이유
    - 네트워크 구성과 설계가 용이하다.
    - 네트워크 문제 진단과 해결이 용이하다.

### OSI 모델

- 국제 표준화 기구에서 만든 네트워크 참조 모델로, 통신 단계를 7개의 계층으로 나눈다.
- 주로 네트워크를 이론적으로 기술하고 이해할 때 사용한다. ⇒ 이상적 설계

1. **물리계층**
    - 1과 0으로 표현되는 비트 신호를 주고 받는다.
    - 가장 근원적인 통신이 이루어진다.
    - 통신 매체에 맞는 신호로 운반되도록 비트 데이터의 변환이 이루어지고, 통신 매체를 통한 송수신이 이루어진다.

1. **데이터 링크 계층**
    - **네트워크 내 주변 장치 간**의 정보를 올바르게 주고 받기 위한 계층이다.
    - 물리 계층을 통해 주고받는 정보에 오류가 없는지 확인한다.
    - **MAC 주소**를 통해 네트워크 내 송수신지를 특정할 수 있다.
    - 때로는 전송과정에서 발생할 수 있는 충돌 문제를 해결한다.
    - 이더넷을 비롯한 많은 LAN 기술이 데이터 링크 계층에 녹아있다.
    
2. **네트워크 계층**
    - 메시지를 (다른 네트워크에 속한) 수신지까지 전달한다.
    - **네트워크 간**의 통신이 이루어진다.
    - 인터넷을 가능하게 한다.
    - **IP 주소**를 통해 통신하고자 하는 수신지 호스트와 네트워크를 식별하고, 원하는 수신지에 도달하기 위한 최적의 경로를 결정한다.
    
3. **전송 계층**
    - 신뢰성 있고 안정성 있는 전송이 이루어지도록 한다.
    - 패킷이 정상적으로 보내졌는지, 중간에 유실된 정보는 없는지, 여러 개의 패킷을 보낼 때 순서가 뒤바뀐 것은 없는지 등을 확인해야할 때, 패킷의 흐름을 제어하거나 전송 오류를 점검한다.
    - 이외에도 포트를 통해 실행 중인 응용 프로그램의 식별이 이루어지기도 한다.
    
4. **세션 계층**
    - 세션(통신을 주고받는 호스트의 응용 프로그램 간 연결 상태)을 관리한다.
    - 연결 상태를 생성하거나 유지하고, 종료되었을 때는 끊어주는 역할을 담당한다.
    
5. **표현 계층**
    - 번역과와 같은 역할을 한다.
    - 사람이 이해할 수 있는 언어인 문자를 컴퓨터가 이해할 수 있는 코드로 변환하거나, 압축, 암호화와 같은 작업이 이루어진다.
    
6. **응용 계층**
    - 사용자 및 사용자가 이용하는 응용프로그램과 가장 밀접히 맞닿아 있다.
    - 사용자가 이용할 응용프로그램에 다양한 네트워크 서비스를 제공한다.
    - 실질적인 네트워크 서비스를 제공한다. 
    ex) 웹 브라우저 프로그램에 웹 페이지 제공, 이베일 클라이언트 프로그램에 송수신된 이메일을 제공
    

### TCP/IP 모델

- 이론보다는 구현에 중점을 둔 네트워크 참조 모델이다. ⇒ 실용적 구현
- TCP/IP 4계층, 인터넷 프로토콜 스위트, TCP/IP 프로토콜 스택 이라고도 부른다.

1. **네트워크 액세스 계층**
    - 링크 계층, 네트워크 인터페이스 계층 이라고도 부른다.
    - OSI 모델의 2) 데이터 링크 계층과 유사하다.
2. **인터넷 계층**
    - OSI 모델의 3) 네트워크 계층과 유사하다.
3. **전송 계층**
    - OSI 모델의 4) 전송 계층과 유사하다.
4. **응용 계층** 
    - OSI 모델의 5) 세션 계층, 6) 표현 계층, 7) 응용 계층을 합친 것 과 유사하다
   

## 캡슐화와 역캡슐화

- 패킷은 송신 과정에서 **캡슐화**, 수신 과정에서 **역캡슐화**가 이루어진다.
- 송수신하는 메시지는 **송신지** 입장에서는 가장 높은 계층 → 가장 낮은 계층으로 이동하고, **수신지** 입장에서는 가장 낮은 계층 → 가장 높은 계층으로 이동한다

### 캡슐화
- Remind
    - 패킷 교환 네트워크에서 메시지는 패킷 단위로 송수신 된다. *(택배와 비슷한 개념)*
    - 패킷은 헤더와 페이로드, 때로는 트레일러를 포함하여 구성된다.
    - 프로토콜의 목적과 특징에 따라 헤더의 내용은 달라질 수 있다.
- 캡슐화 = 인캡슐레이션 = encapsulation
- 어떤 정보를 송신할 때 각 계층에서는 상위 계층으로부터 내려받은 패킷을 페이로드 삼아, 프로토콜에 걸맞은 헤더(혹은 트레일러)를 덧붙인 후 하위 계층으로 전달한다.
- 캡슐화는 **데이터 전송 과정에서 헤더 및 트레일러를 추가**해 나가는 과정을 의미한다.

### 역캡슐화

- 어떤 메시지를 수신할 때는 캡슐화 과정에서 붙였던 헤더(및 트레일러)를 각 계층에서 확인한 뒤 제거한다.
- 역캡슐화는 **캡슐화 과정에서 붙인 헤더(및 트레일러)를 제거**하는 과정을 의미한다.

![Image](/Network/image/1.png)


## PDU

- 각 계층에서 송수신 되는 메시지의 단위
- 현재 계층의 PDU = 상위 계층에서 전달한 데이터 + 현재 계층의 프로토콜 헤더(및 트레일러)

| OSI 계층 | PDU |
| --- | --- |
| 응용 계층 | **데이터**(data), 메시지(message) |
| 표현 계층 | **데이터**(data) |
| 세션 계층 | **데이터**(data) |
| 전송 계층 | TCP 프로토콜이 사용되었을 때: **세그먼트**(segment), <br>UDP 프로토콜이 사용되었을 때: **데이터그램**(datagram) |
| 네트워크 계층 | **IP 패킷**(packet), IP 데이터그램 |
| 데이터 링크 계층 | **프레임**(frame) |
| 물리 계층 | **비트**(bit), 심볼(symbol) |

## 트래픽과 네트워크 성능 지표

### **트래픽**

- 네트워크 내의 정보량을 의미한다.
- 특정 노드에 트래픽이 몰린다 = 해당 노드가 특정 시간동안 처리해야할 정보가 많다
  ⇒ 이 경우 해당 노드에 과부하가 생길 수 있다.
    

### 네크워크 성능 지표

1. **처리율 (throughput)**
    - **단위 시간 당 네트워크를 통해 실제로 전송되는 정보량**
    - bps, Mbps, Gbps, pps 단위로 표현한다
    - 비교적 실시간성이 강조된 지표이다
    - 특정 노드가 얼마만큼의 트래픽을 처리하는 중인지 판단한다
    - 매순간 변하는 모습으로 표현되거나, 처리율의 평균값이 주로 활용된다
  
2. **대역폭 (bandwidth)**
    - 신호 처리 영역에서의 정의: 주파수의 범위
    - 네트워크 성능 측정 영역에서의 정의: **단위 시간 동안 통신 매체를 통해 송수신할 수 있는 최대 정보량**
    - bps, Mbps, Gbps 단위 사용
    - 통신 매체가 높은 대역폭을 가질 수 있다 = 많은 정보를 송수신할 능력이 있다
      
3. **패킷 손실 (packet loss)**
    - 송수신되는 패킷이 손실된 상황
    - 높은 트래픽으로 인해 노드가 순간적으로 처리해야 할 패킷이 너무 많아지거나, 네트워크 상에 예기치 못한 장애가 발생해서 패킷을 처리하지 못할 때 발생한다
    - 명령 프롬프트(CMD) 혹은 터미널에서 `ping` 명령어로 확인할 수 있다.
